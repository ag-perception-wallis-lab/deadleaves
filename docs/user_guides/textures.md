---
jupytext:
  formats: md:myst
  text_representation:
    extension: .md
    format_name: myst
kernelspec:
  display_name: Python 3
  language: python
  name: python3
---

# Textures

Textures add variation to the color of each leaf, giving images more realism and complexity.
They can be applied as noise or by using predefined texture patches.
Texture parameters are passed via the `texture_param_distributions` dictionary when creating a `DeadLeavesImage`.

## Noise

Noise textures are generated by sampling values from a given distribution for each pixel and adding them to the color of the leaf.
Noise can be applied in any of the supported color spaces (`gray`, `RGB`, `HSV`), texture and color space do not have to be the same.

### Per-Pixel Noise

If the texture is parameterized the same way as the color, the same noise distribution is applied across the entire image.
For example, adding gray-scale Gaussian noise to an image:

```
{
    "gray": <distribution>
}
```

- **Effect**: All leaves share the same pixel-level noise characteristics.
- **Use case**: Simple global texture effects.

**Example**

```{code-cell}
:tags: [hide-input]
from dead_leaves import DeadLeavesModel, DeadLeavesImage

model = DeadLeavesModel(
    shape = "circular", 
    param_distributions = {"area": {"powerlaw": {"low": 100.0, "high": 10000.0, "k": 1.5}}},
    size = (512,512)
)
leaves, partition = model.sample_partition()

colormodel = DeadLeavesImage(
    leaves = leaves, 
    partition = partition, 
    color_param_distributions = {"gray": {"uniform": {"low": 0.0, "high": 1.0}}},
    texture_param_distributions = {
        "gray": {"normal": {"loc": 0, "scale": 0.1}}
        }
    )
image = colormodel.sample_image()

colormodel.show(image, figsize = (3,3))
```

### Per-Leaf Noise

By introducing a hierarchical structure, you can sample noise parameters independently for each leaf.
For example, Gaussian noise per leaf in gray-scale:

```
{
    "gray": {"normal": {"loc": 0.0, "scale": <distribution>}}
}
```

- **Effect**: Each leaf has an independent texture variation.
- **Use case**: Images with heterogeneous textures across objects.

**Example**

```{code-cell}
:tags: [hide-input]
from dead_leaves import DeadLeavesModel, DeadLeavesImage

model = DeadLeavesModel(
    shape = "circular", 
    param_distributions = {"area": {"powerlaw": {"low": 100.0, "high": 10000.0, "k": 1.5}}},
    size = (512,512)
)
leaves, partition = model.sample_partition()

colormodel = DeadLeavesImage(
    leaves = leaves, 
    partition = partition, 
    color_param_distributions = {"gray": {"uniform": {"low": 0.0, "high": 1.0}}},
    texture_param_distributions = {
        "gray": {
            "normal": {
                "loc": 0, 
                "scale": {"uniform": {"low": 0.05, "high": 0.2}}
                }
            }
        }
    )
image = colormodel.sample_image()

colormodel.show(image, figsize = (3,3))
```

## From texture patches

You can also apply textures using predefined gray--scale patches.
Each leaf is assigned a patch and blended with its color using an alpha value:

```python
{
    "source": {"image": {"dir": <value>}},
    "alpha": <distribution>
}
```

- `dir`: Path to the folder containing texture images.
- `alpha`: Blending factor controlling how strongly the texture is applied.
- **Effect**: Each leaf receives a sampled patch, creating complex and realistic surface patterns.
- **Use case**: Generate images that mimic real-world textures or artistic styles.

```{code-cell}
:tags: [hide-input]
from dead_leaves import DeadLeavesModel, DeadLeavesImage

model = DeadLeavesModel(
    shape = "circular", 
    param_distributions = {"area": {"powerlaw": {"low": 100.0, "high": 10000.0, "k": 1.5}}},
    size = (512,512)
)
leaves, partition = model.sample_partition()

colormodel = DeadLeavesImage(
    leaves = leaves, 
    partition = partition, 
    color_param_distributions = {"gray": {"uniform": {"low": 0.0, "high": 1.0}}},
    texture_param_distributions = {
        "source": {"image": {"dir": "../../examples/textures/brodatz"}},
        "alpha": {"normal": {"loc": 0.0, "scale": 0.4}},
    }
    )
image = colormodel.sample_image()

colormodel.show(image, figsize = (3,3))
```